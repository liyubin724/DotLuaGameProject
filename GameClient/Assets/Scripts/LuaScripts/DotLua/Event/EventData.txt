require('DotLua/Class')

local DebugLog = DebugLog

----internal----
--构造函数
--@param receiver 接收事件的table，可为空
--@param func 接收事件处理的处理函数
--@param userdata 自定义参数
EventData =
    Class(
    function(self)
        self.receiver = nil
        self.func = nil
        self.userdata = nil
    end
)

function EventData:GetReceiver()
    return self.receiver
end

function EventData:GetFunc()
    return self.func
end

----internal----
--比较是否相同
--相同的两种情况：
--1：两个对象是同一对象
--2：两个对象中的接收者与处理函数相同
-- @return bool
EventData.__eq = function(data1,data2)
    if data1 == nil or data2 == nil then
        return false
    end

    return data1.receiver == data2.receiver and data1.func == data2.func
end

function EventData:SetData(receiver, func, userdata)
    self.receiver = receiver
    self.func = func
    self.userdata = userdata
end

function EventData:OnRelease()
    self.receiver = nil
    self.func = nil
    self.userdata = nil
end

----internal----
--通知事件执行，由EventDispatcher来调用
-- @param ... 多参数
function EventData:Invoke(eventID, ...)
    if self.func then
        if self.receiver then
            if self.userdata then
                self.func(self.receiver, eventID, self.userdata, ...)
            else
                self.func(self.receiver, eventID, ...)
            end
        else
            if self.userdata then
                self.func(eventID,self.userdata, ...)
            else
                self.func(eventID,...)
            end
        end
    end
end