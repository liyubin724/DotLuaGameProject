local ObjectType = require('DotLua/OOP/ObjectType')
local class = require('DotLua/OOP/class')

local tinsert = table.insert
local sstartswith = string.startswith
local trawgetkeys = table.rawgetkeys

local Enum =
    class(
    'Enum',
    function(self)
        self._isInstance = false
    end
)

Enum.__newindex = function(e, k, v)
    error('Enum', "can't add new key in to the Enum")
end

Enum._type = ObjectType.Enum

function Enum:GetNames()
    if self._names then
        return self._names
    end

    self._names = {}

    local keys = trawgetkeys(self)
    for i = 1, #keys, 1 do
        if not sstartswith(keys[i], '_') then
            tinsert(self._names, keys[i])
        end
    end

    return self._names
end

function Enum:GetValues()
    if self._values then
        return self._values
    end

    self._values = {}

    local names = self:GetNames()
    for i = 1, #names, 1 do
        tinsert(self._values, rawget(self, names[i]))
    end

    return self._values
end

function Enum:GetNameByValue(value)
    for k, v in pairs(self) do
        if v == value then
            return k
        end
    end

    return nil
end

function Enum:IsValidName(name)
    for _, n in ipairs(self:GetNames()) do
        if n == name then
            return true
        end
    end

    return false
end

function Enum:IsValidValue(value)
    for _, v in ipairs(self:GetValues()) do
        if v == value then
            return true
        end
    end
    return false
end

function Enum:ToString()
    local str = string.format('%s:{', self:GetClassName())
    local names = self:GetNames()
    for i = 1, #names, 1 do
        str = str + string.format('%s = %s', names[i], tostring(rawget(self, names[i])))
    end
    str = str + '}'

    return str
end

return Enum
