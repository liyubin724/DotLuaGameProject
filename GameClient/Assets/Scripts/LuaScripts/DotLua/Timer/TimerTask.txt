require('DotLua/Class')
require("DotLua/Callback")

local DebugLog = DebugLog

TimerTask =
    Class(
    function(self)
        self.index = 0
        self.intervalInMS = 0
        self.totalInMS = 0

        self.intervalCallback = nil
        self.endCallback = nil
        self.userdata = nil

        self.remainingInMS = 0
        self.leftInMS = 0
    end
)

function TimerTask:GetIndex()
    return self.index
end

function TimerTask:SetData(index,
                            intervalInSec,
                            totalInSec,
                            receiver,
                            intervalFunc,
                            endFunc,
                            userdata)
    self.index = index

    if totalInSec <= 0 then
        self.totalInMS = 0
    else
        self.totalInMS = math.ceil(totalInSec * 1000)
    end
    if intervalInSec <= 0 then
        self.intervalInMS = 0
    else
        self.intervalInMS = math.ceil(intervalInSec * 1000)
    end

    if intervalFunc then
        self.intervalCallback = Callback(receiver,intervalFunc)
    end
    if endFunc then
        self.endCallback = Callback(receiver,endFunc)
    end
    self.userdata = userdata

    self.remainingInMS = self.intervalInMS
    self.leftInMS = self.totalInMS
end

function TimerTask:IsEnd()

end

function TimerTask:ResetTask()

end

function TimerTask:OnTaskInterval()
    if self.intervalCallback then
        self.intervalCallback:Invoke(self.userdata)
    end
end

function TimerTask:OnTaskEnd()
    if self.endCallback then
        self.endCallback:Invoke(self.userdata)
    end
end

function TimerTask:Reset()
    self.index = 0
    self.intervalInMS = 0
    self.totalInMS = 0

    self.intervalCallback = nil
    self.endCallback = nil
    self.userdata = nil

    self.remainingInMS = 0
    self.leftInMS = 0
end