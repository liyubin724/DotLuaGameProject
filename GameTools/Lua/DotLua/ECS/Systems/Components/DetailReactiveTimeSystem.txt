local oop = require('DotLua/OOP/oop')
local TimeUpdateSystem = oop.using('Dotlua/ECS/Systems/Update/TimeUpdateSystem')
local DetailCollector = oop.using('DotLua/ECS/Collectors/DetailCollector')

local LogTag = 'DetailReactiveTimeSystem'

local DetailReactiveTimeSystem =
    oop.class(
    'DotLua.ECS.Systems.Components.DetailReactiveTimeSystem',
    function(self, group, groupEvents, frequencyInFrame)
        self.detailCollector = DetailCollector(group, groupEvents)

        self:SetFrequency(frequencyInFrame)
    end,
    TimeUpdateSystem
)

function DetailReactiveTimeSystem:onActivate()
    self.collector:Activate()
end

function DetailReactiveTimeSystem:onDeactivate()
    self.collector:Deactivate()
end

function DetailReactiveTimeSystem:onTimeUpdate(deltaTime)
    local addedDetails = self.detailCollector:GetAddedDetails()
    if addedDetails and #(addedDetails) > 0 then
        for _, data in ipairs(addedDetails) do
            self:onAddedDetailUpdate(deltaTime, data)
        end
    end

    local removedDetails = self.detailCollector:GetRemovedDetails()
    if removedDetails and #(removedDetails) > 0 then
        for _, data in ipairs(removedDetails) do
            self:onRemovedDetailUpdate(deltaTime, data)
        end
    end
end

function DetailReactiveTimeSystem:onAddedDetailUpdate(deltaTime, data)
    oop.error(LogTag, 'this is a abstract class')
end

function DetailReactiveTimeSystem:onRemovedDetailUpdate(deltaTime, data)
    oop.error(LogTag, 'this is a abstract class')
end

return DetailReactiveTimeSystem
