local oop = require('DotLua/OOP/oop')
local System = oop.using('DotLua/ECS/Systems/System')

local TimeUpdateSystem =
    oop.class(
    'DotLua.ECS.Systems.Update.TimeUpdateSystem',
    function(self,frequencyInTime)
        self.frequencyInTime = frequencyInTime or 0
        self.elapseDeltaTime = 0
    end,
    System
)

function TimeUpdateSystem:GetFrequency()
    return self.frequencyInTime
end

function TimeUpdateSystem:SetFrequency(frequency)
    self.frequencyInTime = frequency
    self.elapseDeltaTime = 0
end

function TimeUpdateSystem:onActivate()
    self.elapseDeltaTime = 0
end

function TimeUpdateSystem:onDeactivate()
    self.elapseDeltaTime = 0
end

function TimeUpdateSystem:DoUpdate(deltaTime, unscaleDeltaTime)
    if self.isEnable then
        self.elapseDeltaTime = self.elapseDeltaTime + deltaTime

        if self.elapseDeltaTime >= self.frequencyInTime then
            if self.frequencyInTime <= 0 then
                self:onTimeUpdate(self.elapseDeltaTime)
                self.elapseDeltaTime = 0
            else
                self:onTimeUpdate(self.frequencyInTime)
                self.elapseDeltaTime = self.elapseDeltaTime - self.frequencyInTime
            end
        end
    end
end

function TimeUpdateSystem:onTimeUpdate(deltaTime)
end

return TimeUpdateSystem
