require("DotLua/Init")

local GameEnv = require("Game/ECS/GameEnv")

local logger = _G.logger
if not _G.isDebug then
    logger.info = nil
    logger.warning = nil
end

local ecs = _G.ecs

Launcher = {}
function Launcher.DoStart()
    local CSLogUtil = CS.DotEngine.Log.LogUtil
    if _G.isDebug then
        logger.debug = CSLogUtil.Debug
        logger.info = CSLogUtil.Info
        logger.warning = CSLogUtil.Warning
        logger.error = CSLogUtil.Error
    else
        logger.debug = nil
        logger.info = nil
        logger.warning = nil
        logger.error = CSLogUtil.Error
    end

    ecs.Initialize(GameEnv)

    local poolMgr = CS.DotEngine.UPool.PoolManager.GetInstance()
    local globalCategory = poolMgr:GetCategory("Global Category")
    local rootGObjectGroup = globalCategory:GetGroup("Global Root Group")
    local gObject = rootGObjectGroup:GetItem(true)
    gObject.name = "Test Root"
    gObject.transform:SetParent(nil)

    logger.Info("Launcher", "Game Start")
end

function Launcher.DoUpdate(deltaTime, unscaleDeltaTime)
    ecs.Update(deltaTime, unscaleDeltaTime)
end

function Launcher.DoDestroy()
    ecs.Destroy()
end
