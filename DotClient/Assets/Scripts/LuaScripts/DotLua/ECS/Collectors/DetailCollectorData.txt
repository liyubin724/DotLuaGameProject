local oop = require("DotLua/OOP/oop")
local ContextEvent = oop.using("DotLua/ECS/Contexts/ContextEvent")

local DetailCollectorData =
    oop.class(
    "DetailCollectorData",
    function(self)
        self.guid = nil
        self.entity = nil
        self.contextEvent = nil

        self.addedComponentClass = nil
        self.removedComponentClass = nil
        self.modifiedComponentClass = nil
        self.modifiedTag = nil
    end
)

function DetailCollectorData:GetEntity()
    return self.guid, self.entity
end

function DetailCollectorData:GetContextEvent()
    return self.contextEvent
end

function DetailCollectorData:GetEntityChangedData()
    if self.contextEvent == ContextEvent.EntityCreated then
        return self.guid, self.entity
    elseif self.contextEvent == ContextEvent.EntityReleased then
        return self.guid, nil
    elseif self.contextEvent == ContextEvent.EntityChangedForAddComponent then
        return self.guid, self.entity, self.addedComponentClass
    elseif self.contextEvent == ContextEvent.EntityChangedForRemoveComponent then
        return self.guid, self.entity, self.removedComponentClass
    elseif self.contextEvent == ContextEvent.EntityChangedForReplaceComponent then
        return self.guid, self.entity, self.removedComponentClass, self.addedComponentClass
    elseif self.contextEvent == ContextEvent.EntityChangedForModifyComponent then
        return self.guid, self.entity, self.modifiedComponentClass, self.modifiedTag
    end

    return nil
end

function DetailCollectorData:DoGet(entity, contextEvent, param1, param2)
    self.entity = entity
    self.guid = entity:GetGUID()
    self.contextEvent = contextEvent

    if self.contextEvent == ContextEvent.EntityChangedForAddComponent then
        self.addedComponentClass = param1
    elseif self.contextEvent == ContextEvent.EntityChangedForRemoveComponent then
        self.removedComponentClass = param1
    elseif self.contextEvent == ContextEvent.EntityChangedForReplaceComponent then
        self.removedComponentClass = param1
        self.addedComponentClass = param2
    elseif self.contextEvent == ContextEvent.EntityChangedForModifyComponent then
        self.modifiedComponentClass = param1
        self.modifiedTag = param2
    elseif self.contextEvent == ContextEvent.EntityReleased then
        self.entity = nil
    end
end

function DetailCollectorData:DoRelease()
    self.guid = nil
    self.entity = nil
    self.contextEvent = nil

    self.addedComponentClass = nil
    self.removedComponentClass = nil
    self.modifiedComponentClass = nil
    self.modifiedTag = nil
end

return DetailCollectorData
