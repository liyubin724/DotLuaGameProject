local oop = require("DotLua/ECS/OOP/oop")
local UpdateSystem = require("DotLua/ECS/Systems/Update/UpdateSystem")

local LogTag = "GroupUpdateSystem"

local GroupUpdateSystem =
    oop.class(
    "DotLua.ECS.Systems.GroupUpdateSystem",
    function(self, context)
        self.context = context
        self.group = nil
    end,
    UpdateSystem
)

function GroupUpdateSystem:onInitlize()
    self._base.onInitlize(self)

    self.group = self:createGroup(self.context)
end

function GroupUpdateSystem:onDestroy()
    if self.group then
        self.context:ReleaseGroup(self.group)
    end
    self.group = nil
    self.context = nil
end

function GroupUpdateSystem:onUpdate(deltaTime)
    if not self.group then
        return
    end

    local entities = self.group:GetEntities()
    for i = 1, #entities do
        local entity = entities[i]
        if self:filterEntity(entity) then
            self:onEntityUpdate(entity, deltaTime)
        end
    end
end

function GroupUpdateSystem:createGroup(context)
    return nil
end

function GroupUpdateSystem:filterEntity(entity)
    return true
end

function GroupUpdateSystem:onEntityUpdate(entity, deltaTime)
    oop.error(LogTag, "this is a abstract class")
end

return GroupUpdateSystem
